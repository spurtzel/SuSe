#!/bin/bash
set -eo pipefail

QUERIES=('abcdefghijkl' 'abcdefgh*i*jkl' 'ab*cde*fgh*i*jkl' 'ab*c*de*f*gh*i*jkl' 'a*b*c*de*f*g*h*i*jkl' 'a*b*c*de*f*g*h*i*jk*l*')
SUMMARY_SIZES=(500) 
TIME_WINDOW_SIZES=(100) 
STREAM_SIZES=(25000)
TIMES_TO_LIVE=(25000)
PROB_DISTRIBUTIONS=("zipf")
EVAL_TIMESTAMPS_COUNTS=(50)
EVAL_TIMESTAMPS_PROB_DISTS=("poisson")
NUM_OF_RUNS=(10)

SEEDS=(16163 20196 10197 28146 12976 18206 10572 20523 13864 27544 17099 23598 18444 4451 11350 19882 3957 16158 14127 4908 18974 13388 355 17902 25111 25967 23802 28980 9086 6466 7516 4265 21527 18883 31660 1768 4726 32087 27712 6815 25353 19249 17002 2493 12833 19133 14193 12271 23415 32644 27378 23145 16757 20637 13403 17477 30681 15900 10089 18253 15379 22196 29982 4982 2387 8443 13239 23457 10604 18942 23860 955 20017 4815 27079 3684 13938 2336 31217 19722 27587 19831 15763 12705 18961 4238 25334 16426 23811 20936 2585 14934 293 4883 13652 28065 13229 19905 22220 31720 31372 6556 30488 3417 2774 10762 31121 11392 17284 9449 28338 11389 12589 24863 28840 29193 31778 28009 24047 28813 24990 25662 13614 14684 22720 26920 26209 3061 32544 1044 8071 23119 15944 32521 372 15132 11214 5100 1950 22490 13656 28221 6837 30281 20175 25796 15260 26094 3090 1364 31868 15012 29495 10507 4190 2219 12130 29890 21430 18674 27572 17590 12749 21918 26504 23972 3127 6341 13330 8328 27836 10171 1673 763 20589 5203 5954 3395 31724 8533 30461 8992 27858 16807 2051 9000 29675 12832 797 9954 303 20958 9234 4364 3912 18808 19613 12171 10 31973 7217 2507 9854 32201 32236 25424 31445 23581 985 21880 6055 4389 7371 3190 5492 20656 13699 27941 30375 15730 25530 19462 11646 2020 19830 3950 30378 28733 5573 30837 17867 26183 30656 14127 7010 11103 15278 3851 29816 22770 3501 32181 2961 28436 30947 14255 21313 3385 5066 8003 18059 12266 11512 16042 19423 28988 13234 5605 18636 25155 20431 20609 23664 7680 30225 31083 18618 2898 2872 14091 8666 17910 5627 26547 25573 750 780 20351 24413 28203 9719 22223 19797 32294 6655 31404 23360 45 5810 27338 29763 14617 14143 32562 29032 5195 22218 6540 20490 20991 45 5182 25423 3941 12731 19341 10853 7898 13891 21127 6426 4575 6087 4367 30830 19059 551 4569 10508 12871 14813 14556 2356 6757 32067 21321 14171 2265 327 29016 24324 21457 496 2939 22943 26956 12492 15532 29866 3195 28755 4831 32097 28940 15561 22473 30126 1568 24511 5605 30587 19941 3300 26350 24482 1711 14555 29231 15144 21857 3844 28854 15814 6413 1067 23394 18770 25372 14144 16814 7504 8894 27200 22912 31935 17436 20665 9836 13908 2384 22928 15768 13452 25778 18716 18917 19569 5980 4567 25969 1403 5208 11426 24636 4116 5954 24798 7293 19312 17655 12669 9485 20617 1979 7796 7144 2692 3138 21696 19985 27029 31612 20786 17345 4218 28601 11339 29161 7598 28830 28450 26666 25850 20856 29181 15781 13289 18822 25019 25036 24368 29524 12556 31228 3633 10336 22146 6492 27660 31762 29402 7797 4599 6238 28152 4519 21211 9590 17271 32737 22153 22497 566 3792 28559 26557 28312 13628 4770 22034 9481 36 20150 22128 23647 21832 9322 3511 23165 4240 10868 23877 5008 8494 8384 1657 950 29826 28278 258 27661 631 8652 17227 10741 27014 17003 10144 10128 26626 18204 29205 27075 21529 5796 16579 24932 32499 30347 25680 20037 27920 7553 5816 27181 1682 9761 30487 14867 4022 8139 7323 22373 9502 5637 21066 15104 5065 4514 13758 4905 25822 31408 21025 1266 4252 19958 19983 23523 24278 2470 994 1821 1169 21177 23640 18222 18723 5744 28826 14971 19878 25120 16916 22428 4031 14318 15017 6821 30832)

rm -f report.csv
rm -f seeds.txt

for query in "${QUERIES[@]}"
do
seed_index=0
        for time_window_size in "${TIME_WINDOW_SIZES[@]}"
        do
                for summary_size in "${SUMMARY_SIZES[@]}"
                do
                        for stream_size in "${STREAM_SIZES[@]}"
                        do
                                for time_to_live in "${TIMES_TO_LIVE[@]}"
                                do
                                        for prob_distribution in "${PROB_DISTRIBUTIONS[@]}"
                                        do
                                                for eval_timestamp_count in "${EVAL_TIMESTAMPS_COUNTS[@]}"
                                                do
                                                        for eval_timestamp_dist in "${EVAL_TIMESTAMPS_PROB_DISTS[@]}"
                                                        do
                                                                for ((run=1; run<=NUM_OF_RUNS; run++))
                                                                do
                                                                        RANDOM_SEED=${SEEDS[$seed_index]}
                                                                        ((seed_index += 1))
                                                                        bash run_test.sh \
                                                                                ${summary_size} \
                                                                                ${time_window_size} \
                                                                                ${stream_size} \
                                                                                ${time_to_live} \
                                                                                ${prob_distribution} \
                                                                                ${eval_timestamp_count} \
                                                                                ${eval_timestamp_dist} \
                                                                                ${RANDOM_SEED} \
                                                                                "${query}" >/dev/null &
                                                                done
                                                        done
                                                done
                                        done
                                done
                        done
                done
        done
done

wait
