#!/bin/bash
set -eo pipefail

QUERIES=("a(b*c)*d(e|f)g*")
SUMMARY_SIZES=(100 250 500) 
TIME_WINDOW_SIZES=(10 25 50 100 250) 
STREAM_SIZES=(10000)
TIMES_TO_LIVE=(10000)
PROB_DISTRIBUTIONS=("uniform" "normal")
EVAL_TIMESTAMPS_COUNTS=(25)
EVAL_TIMESTAMPS_PROB_DISTS=("poisson")
NUM_OF_RUNS=(25)

SEEDS=(3453 889 30225 11295 17164 3421 32379 20919 19984 5717 17073 8013 5879 23318 32366 6150 890 22174 19908 23302 31790 3650 14123 23915 14404 26795 22394 20065 11461 5004 16644 17602 3570 32163 2949 20287 16025 28566 18183 10735 23608 15828 16431 14568 28662 4299 16760 26194 715 18360 28857 25421 18649 18616 5858 4417 11751 29999 19820 22442 20396 22978 32449 10722 12487 29644 9652 13007 16302 8049 17401 26078 22308 29289 30193 17670 28786 1405 15269 19268 23386 6745 21591 747 13102 22362 2532 28561 4210 3781 23089 2024 29710 17105 10103 32177 12513 17815 12791 32449 9574 4675 23367 29427 11745 23598 21439 28923 23714 10449 29952 28929 29988 20637 1537 31306 25692 9960 30440 552 1293 2828 19464 25009 7329 17630 19401 6545 9581 28339 21301 17327 18182 26454 12663 21002 11969 27393 22834 4358 26163 14012 24613 30547 5016 19304 14258 29177 32542 5020 11788 19496 25930 9460 24041 16713 1112 15493 22708 29726 11542 13211 21258 1994 23397 1616 11467 2868 27990 20109 3744 3065 30291 23361 12084 5181 32575 24756 25488 4010 10503 13175 27503 28615 26406 17884 25360 24970 2214 9124 6232 18630 17528 24997 13033 671 12137 12503 14379 13371 196 3678 17452 30968 15307 21574 8689 31099 22416 11187 27045 19422 2508 4441 20058 11767 16603 30908 14506 15593 24753 25203 3729 8411 15997 27015 891 21807 2332 16134 25140 29632 29775 29130 23077 13077 1373 649 23276 13749 24589 28016 28144 11038 492 15892 29029 10893 30473 2463 1782 32448 25834 12072 30767 12919 27794 11928 24593 28136 9796 20938 29262 14258 1903 10394 15683 4339 22771 26261 11602 3330 30891 27099 14944 18173 8102 23648 29915 16178 3346 24360 28495 28064 19643 21682 15353 13884 32488 10 30301 29447 16251 4085 27023 75 6253 17504 14879 24402 6986 18385 774 3785 4888 7682 1086 7566 31986 17486 12634 5032 322 30858 4385 13662 26150 1332 1441 23518 13412 22144 5803 24241 29853 18977 15761 29577 29751 24712 31613 22647 32195 28483 16677 13548 21101 29711 18322 31315 8450 21740 14262 1210 15895 31818 23492 23492 27473 30929 18660 30928 25715 29478 21321 26084 22613 728 13076 11624 30402 7770 10288 9814 28940 7288 26065 10534 4563 5696 10981 16573 2258 28537 26314 608 21251 10660 24054 11108 12800 26227 28332 43 4618 5352 4894 25403 14412 8097 26820 20306 29959 8829 479 829 1784 5684 2462 4185 1919 19105 25107 920 22921 24800 5505 10272 7976 31242 5897 2235 24338 3821 8710 12502 29833 24329 16746 8550 14680 23902 11170 28623 3827 19969 17283 8631 22458 12570 7513 6068 18832 5222 23673 22618 18764 18410 18512 22515 23450 23062 29847 17018 15783 25842 30372 26843 28023 13932 10861 8787 21840 15898 3814 9864 8209 16316 32627 5457 3579 23448 24358 32166 1306 25384 2781 15220 10119 3397 26681 18484 8945 24550 4652 3091 8440 22248 21984 8082 29641 23837 25075 27882 8537 28839 9575 7325 31454 30784 29195 25299 27063 3338 28190 7639 30452 15088 5915 8704 4639 7955 12836 20213 28444 24502 25668 14416 24961 19987 400 23423 27309 720 23469 9473 4470 16901 30449 4497 30286 23335 11692 14542 19985 30242 1888 3589 27876 21737 8445 27122 8553 6048 7583 27559 25641 6306 1261 24457 23621 17172 28673 7964 30386 13013 17361 5008 3759 32380 25111 11359 3922 26444 28918 23084 10138 4118 7981 23943 30857 22541 3493 19232 29982 10626 16844 16044 23903 23463 23653 31724 22467 5537 19660 1580 29828 32489 21513 2283 4516 23127 30716 27604 1195 24164 2003 31701 9287 31168 26008 7212 1769 762 19108 777 26345 22927 873 21232 3508 23495 30565 26347 1614 7998 28261 23801 24240 24302 7392 2778 18683 21430 30606 8503 8355 18440 25408 23732 14257 11603 3292 18055 3886 22543 1250 18056 30676 4963 17780 9122 6108 27197 14218 24704 12099 1398 6750 2061 20316 26780 13051 3701 18410 11899 29510 23287 14582 3820 18447 21533 29441 1073 15044 5752 18832 3737 29748 10764 7485 22557 13064 3275 9706 10277 7828 5773 14432 10070 23554 16640 30614 11977 12050 3835 21151 7067 19834 9930 8536 24590 728 23658 29316 23176 9143 16932 9272 963 18334 5450 9436 3348 25981 31023 1696 26931 20753 29321 20550 17080 3126 16139 23055 25953 8632 169 18761 112 22657 3113 10302 24501 3776 6392 31818 22842 12469 2038 24710 29390 1615 30414 13745 2948 26465 17598 25860 713 11967 16836 9175 14942 12136 27281 11147 14859 20665 23538 24615 14663 69 1809 6405 9376 28765 28847 17428 6719)

rm -f report.csv
rm -f seeds.txt

for query in "${QUERIES[@]}"
do
seed_index=0
        for time_window_size in "${TIME_WINDOW_SIZES[@]}"
        do
                for summary_size in "${SUMMARY_SIZES[@]}"
                do
                        for stream_size in "${STREAM_SIZES[@]}"
                        do
                                for time_to_live in "${TIMES_TO_LIVE[@]}"
                                do
                                        for prob_distribution in "${PROB_DISTRIBUTIONS[@]}"
                                        do
                                                for eval_timestamp_count in "${EVAL_TIMESTAMPS_COUNTS[@]}"
                                                do
                                                        for eval_timestamp_dist in "${EVAL_TIMESTAMPS_PROB_DISTS[@]}"
                                                        do
                                                                for ((run=1; run<=NUM_OF_RUNS; run++))
                                                                do
                                                                        RANDOM_SEED=${SEEDS[$seed_index]}
                                                                        ((seed_index += 1))
                                                                        bash run_test.sh \
                                                                                ${summary_size} \
                                                                                ${time_window_size} \
                                                                                ${stream_size} \
                                                                                ${time_to_live} \
                                                                                ${prob_distribution} \
                                                                                ${eval_timestamp_count} \
                                                                                ${eval_timestamp_dist} \
                                                                                ${RANDOM_SEED} \
                                                                                "${query}" >/dev/null &
                                                                done
                                                        done
                                                done
                                        done
                                        wait
                                done
                        done
                done
        done
done
