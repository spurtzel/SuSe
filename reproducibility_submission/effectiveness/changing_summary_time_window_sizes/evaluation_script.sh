#!/bin/bash
set -eo pipefail

QUERIES=("a(b*c)*d(e|f)g*")
SUMMARY_SIZES=(100 250 500 1000 2500 5000) 
TIME_WINDOW_SIZES=(10 25 50 100 250) 
STREAM_SIZES=(25000)
TIMES_TO_LIVE=(25000)
PROB_DISTRIBUTIONS=("zipf")
EVAL_TIMESTAMPS_COUNTS=(50)
EVAL_TIMESTAMPS_PROB_DISTS=("poisson")
NUM_OF_RUNS=(10)

SEEDS=(15097 25647 32673 9636 16983 23709 1345 11338 28536 27976 11184 20959 22234 30256 2815 24201 29380 7375 26133 1085 10934 5134 12344 12856 2620 27188 24327 14955 24203 1861 20599 31581 2956 6967 4743 22289 25615 16160 8810 31148 12915 9872 6176 32166 17434 25744 4234 4564 21062 1549 32149 23529 10461 16934 27332 30917 31933 23645 6298 31642 16904 8183 24852 1434 21348 23086 3124 27928 23006 12047 26026 13209 27284 15604 22483 10891 17259 22857 32240 31131 9167 28811 30294 12524 2732 28150 16126 31313 4039 1642 5330 11826 23386 24438 19191 15052 2985 15507 32407 32417 4105 287 2165 30102 6190 1843 4056 6877 18270 7718 11304 20817 16764 24697 1843 26389 12175 24283 2757 10131 5251 5419 5724 1710 31429 18077 30767 9192 30323 18814 32133 10651 7586 22897 16977 26548 3810 4139 17466 1815 30786 10257 24885 10934 17553 13235 24782 27104 930 21104 1677 24138 27775 571 10971 22391 2928 17905 28036 20092 27045 20376 32746 11464 12295 28508 32628 20062 1550 5515 23243 16358 16621 4686 15473 24807 6812 13626 13511 24922 18950 29693 13834 13605 17452 18202 7437 29403 17612 15517 50 6663 26414 32463 20556 3461 24826 22982 23782 8566 8468 13400 26519 15681 6368 12608 16766 21352 1717 18440 1318 275 10160 26192 15646 32588 10527 18226 4988 18058 31015 28668 1004 10187 8564 8475 30242 12436 16410 24356 6599 14200 13992 29811 16664 10740 16464 2696 10058 2692 17963 13576 24163 12157 21470 5283 23714 21966 14556 5261 7696 10127 4887 4555 28211 32582 15024 28825 3566 811 329 7274 22785 18658 27628 29075 21669 30330 8363 4997 28045 25366 19444 27823 32372 29654 21065 12971 32310 760 20298 22947 12531 20500 14725 18305 32134 23124 1075 10992 5425 13373 7297 10641 26344 16543 31978 21057 9468 29858 31362 10274 17109 16882 1546 5498 15895 26001 23752 12590 13407 3213 20982 32029 2342 25554 8098 31880 7222 6464 14464 31245 17919 24781 2734 18268 6331 16628 29141 18449 13979 1764 9124 6241 25808 8842 16720 7963 15899 8878 19063 25519 15820 10945 25037 28062 18314 29131 11877 22974 17534 27380 12074 127 17291 19126 4720 9497 10963 15125 19059 13506 6158 21916 27808 24368 30247 9929 30982 13001 29567 5661 19755 16312 27610 18349 21242 23484 18386 14538 15923 24855 18260 5145 19084 9751 27243 11521 2367 1849 21933 17841 28145 3190 14080 11049 22672 3488 9626 28902 24736 16835 18244 26095 1084 28908 25535 9911 24611 22930 22835 23306 30894 30393 12916 30317 23110 6438 2187 18868 19209 2229 25567 16907 24132 29286 5856 32308 30242 29120 20955 20907 15927 26646 3656 6568 21346 29529 4737 8117 12529 19258 19299 8943 21186 17776 6111 28147 6729 17609 30307 14327 12288 7715 6441 5760 4222 111 19156 6614 20329 17212 23376 27702 11263 5652 6575 20449 8271 11627 13404 15513 5977 11706 9584 1295 28436 704 27621 16956 8608 8371 12181 26154 13604 7935 10979 2389 17289 10728 3561 7929 14466 32441 9730 29329 14753 30691 7125 22836 16032 32714 26408 13711 13416 15000 27825 7874 17257 9455 15541 14849 16638 18566 16805 25054 22893 10410 26109 22117 9236 15775 19081 22494 2720 20087 12119 29905 24769 11026 22324 17757 2659 17096 18436 13703 7931 3751 27525 9382 27671 17636 24932 26241 1843 16423 23082 22088 4715 25199 18921 15494 27945 21072 2912 27847 18497 23830 336 4289 3577 27399 18503 24839 1293 4691 19800 17655 11901 8448 30078 13229 27890 13176 16704 3420 7799 6695 5434 26633 18490 18436 17465 11437 28398 3430 12214 14206 1302 549 23611 26528 26515 3669 8156 8067 23150 20981 25969 12020 13349 22422 11254 478 456 18095 30850 6432 15192 6568 17913 24352 21914 1740 25210 28010 26282 2222 8639 14648 26083 14561 13544 16086 93 20433 18560 28944 12479 15999 1606 32388 7219 5204 6328 8491 17964 16969 22142 8135 17409 8454 22118 10037 2716 2008 25552 27090 23516 26622 14855 25613 22819 19259 21904 6446 785 32333 21672 24405 14940 25084 1150 28734 21145 1106 7896 4101 5237 15975 23941 26105 4204 13111 6301 27378 24174 8215 14928 15276 13700 13981 21539 14488 1091 26301 7382 9265 28524 17646 14568 30857 29566 21674 18158 3245 26841 26894 2375 30506 32632 8177 1780 31216 22742 606 10082 31082 9120 3376 22831 13238 17979 31406 6122 32707 13934 12749 453 16869 4258 17130 3475 15096 11287 26371 24338 12050 10705 26886 6729 19517 21695 21736 13364 26264 9305 21671 22402 24713 3727 1227 16194 4507 2031 26193 30489 12981 25185 2165 535 1488 5907 16227 29140 15344 2053 28975 20258 5654 4761 30788 9040 13223 20807 4866 16287 30370 2863 2295 30185 1912 1851 30367 21867 17399 32496 29963 23513 1082 8273 6157 8420 24571 18217 26243 15862 25948 5605 17032 21059 22378 27311 27334 14022 9735 10869 24793 32457 30258 15932 22531 5499 4606 1847 3768 23327 290 13851 27425 9633 17410 12584 12501 29805 24750 19974 12156 25899 8016 23745 21530 16603 19630 6636 11358 23898 24267 15053 15755 12177 19445 30528 32415 29315 26614 3760 31048 6421 20457 23804 578 25177 22974 24039 19769 24146 17216 11990 26167 19689 31772 26482 12249 21911 23382 1235 17673 17615 11099 6162 8325 19860 13717 21715 15298 12870 20221 26518 11110 16570 438 8937 22335 8510 23768 15464 2429 7517 26602 26450 25146 5820 13424 10241 4945 22325 24707 25517 24431 6853 10362 14586 18399 30640 14602 18211 21226 2460 19794 17896 20862 17101 4255 756 20387 30725 8900 29575 30945 5256 22599 114 21187 5775 2516 12087 13025 1861 7161 4676 23467 19017 7160 15301 18589 19045 22636 26866 29537 31963 6717 23318 27997 3173 29203 23156 18198 369 3958 21775 8581 8318 22325 5377 25831 756 17527 3378 12418 11720 2738 14570 14951 20956 1600 26273 27336 20818 32376 31133 32049 28805 23142 27483 3453 17586 21546 8796 14630 25863 2309 1025 19618 32064 11721 29416 10433 7178 18703 10742 6719 31014 13455 18494 7016 29581 18217 13792 3039 28445 4475 2278 20995 489 18113 10686 28755 5712 26334 5632 14636 12881 32105 28699 2097 6177 26237 31670 3769 5139 18783 19137 16112 20298 23692 11750 24139 3696 27426 6246 13676 5781 10325 29823 32237 237 27854 7551 10303 18811 32336 31602 987 2267 16027 4761 18352 12390 17718 4723 17628 4710 2242 5637 3855 4469 4142 24724 19805 31807 32590 18369 6536 11521 25475 32329 6900 23083 29844 3894 2988 20818 14997 26641 24955 16389 25141 24171 9781 10251 30692 28858 18931 2400 30619 10828 30346 29678 2292 28883 6156 16321 3609 23324 9095 23900 32741 4908 292 27722 20797 22155 6292 16025 30815 14991 14891 24897 13090 14327 14147 10034 203 20044 21790 6660 25418 21856 16509 8908 13353 19538 27473 9431 20125 18320 6340 14447 31354 24080 10961 1400 13974 30251 26480 32156 13530 10431 28171 26871 11502 22255 12453 16558 27811 2350 5375 25431 12987 11799 32016 8056 25022 23290 26123 19255 28732 18150 19933 23007 31872 23669 17330 12160 11023 31145 1463 9311 3176 9921 24908 30194 27401 3612 26876 20002 29672 16537 32567 19778 25308 24252 6245 483 26737 23268 10722 24879 128 9976 3588 652 18704 2890 22179 12401 10416 32594 14538 31565 25070 24246 22736 10465 623 15399 30592 13021 24727 17147 29784 3595 14266 7068 11790 25026 30860 13521 26789 24973 30527 1100 8310 30542 19809 21909 27521 32208 31712 27434 17149 20383 17403 27676 8625 2894 25464 7229 10065 22790 3859 21612 1925 31262 4696 12346 19810 28643 14989 25167 22640 31892 4223 22435 31877 14533 147 9542 28086 1617 10380 16675 8327 10964 18479 25787 26847 16945 6577 22063 7696 30634 15522 648 28134 32697 11668 7711 8114 5766 28573 19223 11489 19007 18014 11178 18153 4441 16170 19045 24856 22789 9048 23523 28667 7035 28521 771 24705 19251 27696 31493 29617 21590 12873 2553 19333 2780 11905 17147 20383 28032 3888 5192 26404 24161 816 23674 16190 6391 8939 18934 20955 29039 18498 32496 6825 21517 29972 25637 4054 26988 31014 27583 12738 31298 5143 24500 17673 28349 23282 24985 8838 1281 15905 16919 17491 12902 20015 23342 15560 30160 1378 21054 29789 16416 7189 14870 8922 377 4503 101 2494 22849 27814 3996 24406 9392 18839 9896 14038 16529 2479 28887 28812 28513 8616 12326 30241 25142 6258 30944 13684 9610 27423 31029 11587 30342 13912 30431 23520 30037 7164 2861 7483 10754 29895 15055 12738 484 2114 30090 19238 4361 12951 18063 4003 370 3992 5718 5101 2103 25867 17144 26502 3795 4239 12421 21343 22633 23127 31734 3193 30456 2998 13998 2905 60 28362 9227 26009 14523 28905 1794 28366 14052 27349 16759 12022 32737 21324 7286 22316 19178 24818 17689 19547 12592 5527 25379 27198 15211 21044 18392 11293 7951 26199 4402 26 14714 26399 28984 8507 22464 14587 17077 18607 23935 29076 21866 4920 20548 6290 19363 15262 19149 1247 4879 26739 10937 27380 11475 24563 13284 280 30131 17675 5936 16281 31549 32666 15381 3253 32066 7618 4149 58 8022 14670 4241 6817 29641 31977 2603 7100 16947 4699 19574)

rm -f report.csv
rm -f seeds.txt

for query in "${QUERIES[@]}"
do
seed_index=0
        for time_window_size in "${TIME_WINDOW_SIZES[@]}"
        do
                for summary_size in "${SUMMARY_SIZES[@]}"
                do
                        for stream_size in "${STREAM_SIZES[@]}"
                        do
                                for time_to_live in "${TIMES_TO_LIVE[@]}"
                                do
                                        for prob_distribution in "${PROB_DISTRIBUTIONS[@]}"
                                        do
                                                for eval_timestamp_count in "${EVAL_TIMESTAMPS_COUNTS[@]}"
                                                do
                                                        for eval_timestamp_dist in "${EVAL_TIMESTAMPS_PROB_DISTS[@]}"
                                                        do
                                                                for ((run=1; run<=NUM_OF_RUNS; run++))
                                                                do
                                                                        RANDOM_SEED=${SEEDS[$seed_index]}
                                                                        ((seed_index += 1))
                                                                        bash run_test.sh \
                                                                                ${summary_size} \
                                                                                ${time_window_size} \
                                                                                ${stream_size} \
                                                                                ${time_to_live} \
                                                                                ${prob_distribution} \
                                                                                ${eval_timestamp_count} \
                                                                                ${eval_timestamp_dist} \
                                                                                ${RANDOM_SEED} \
                                                                                "${query}" >/dev/null &
                                                                done
                                                        done
                                                done
                                        done
                                        wait
                                done
                        done
                done
        done
done

