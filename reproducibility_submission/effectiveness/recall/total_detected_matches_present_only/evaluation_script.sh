#!/bin/bash
set -eo pipefail

QUERIES=("a(b*c)*d(e|f)g*")
SUMMARY_SIZES=(100 250 500 2000)
TIME_WINDOW_SIZES=(100 250 500)
STREAM_SIZES=(2000)
TIMES_TO_LIVE=(3000)
PROB_DISTRIBUTIONS=("uniform")
EVAL_TIMESTAMPS_COUNTS=(10)
EVAL_TIMESTAMPS_PROB_DISTS=("uniform")
NUM_OF_RUNS=(50)

SEEDS=(19423 24196 31794 24019 5656 31595 28373 26219 21367 10577 8930 10727 24090 13425 22409 23054 15170 2556 32449 18363 28319 13739 12155 4025 10766 25929 15707 3703 5988 22311 26353 18384 20757 31588 2722 54 15981 15029 2684 9105 21420 26834 17181 3696 1883 27883 678 31107 31340 23924 15248 25855 15701 25648 12355 5004 5785 16068 3896 12431 9098 19193 23089 14576 31938 16346 7955 24970 9949 25239 14082 8788 29467 6388 17734 4826 18995 31164 31335 25252 14175 10789 1475 18745 4225 10874 18132 15292 26844 27044 30564 6903 29734 3389 7185 1261 30517 19647 10698 25517 9979 7740 30951 9840 25860 24505 21348 3061 30040 6419 29443 27571 27027 17285 25104 9687 11786 8940 22131 15708 20324 20231 15944 30928 27232 2039 7553 1354 14719 20957 27375 28963 17532 12656 13891 17560 6779 15328 27401 14841 10323 17657 25585 5013 24076 26226 6008 14207 22250 13294 18384 15170 24196 17181 2556 15707 3696 2684 32449 26834 22311 26219 31107 12155 9105 2722 5656 15981 26353 23924 31588 27883 31340 13425 10577 24019 31595 22409 19423 5988 15029 18363 3703 21367 28319 1883 54 678 10727 28373 13739 24090 21420 10766 4025 25929 31794 23054 8930 20757 14576 18745 25517 3896 9949 8788 31938 4225 18995 15248 12355 1261 31335 12431 29467 19647 25855 15701 14175 30517 5785 24970 14082 18132 29734 25252 10789 16346 1475 10874 6903 25648 15292 7185 7955 23089 27044 19193 26844 5004 4826 10698 25239 9098 31164 3389 16068 30564 6388 17734 27401 15944 25860 30928 15708 25585 17285 14719 20324 27027 10323 6419 5013 9979 15328 20957 3061 27375 27232 14841 11786 2039 27571 30951 17560 17532 28963 14207 8940 13294 25104 21348 7740 22250 6008 20231 24505 9840 9687 12656 17657 30040 1354 29443 6779 13891 26226 24076 22131 7553 2556 22311 15170 24196 26353 21420 25929 2722 13425 31588 2684 24019 5656 13739 15981 32449 5988 31794 23054 9105 12155 1883 23924 3703 31595 27883 26834 10727 20757 31107 15707 22409 24090 3696 18384 10577 19423 54 21367 678 10766 26219 28373 8930 28319 31340 4025 15029 17181 18363 3896 31938 27044 25517 31335 8788 1475 14576 26844 18995 19193 7185 12431 10698 12355 30517 29467 29734 4225 14175 16068 9949 15701 14082 5785 5004 18745 10874 25855 31164 25239 18132 24970 25648 16346 10789 19647 9098 4826 30564 1261 25252 6903 6388 23089 15248 15292 7955 3389 17734 1354 26226 13891 2039 8940 27232 22250 25585 14719 17560 3061 20231 14207 30928 29443 17532 12656 24076 9687 5013 13294 21348 17285 7740 9840 15328 24505 30040 6008 25104 27401 15708 11786 27375 6779 14841 7553 27571 20957 10323 15944 9979 6419 22131 20324 30951 28963 27027 17657 25860 5988 24196 5656 28319 23054 25929 19423 18384 26353 678 8930 31107 20757 12155 26219 31794 23924 13425 21367 32449 31595 21420 2684 31588 27883 15170 10577 3703 26834 22311 18363 54 13739 24019 28373 4025 17181 15029 22409 10766 15707 31340 9105 3696 10727 2556 2722 1883 15981 24090 25239 3896 5785 10874 24970 7955 25855 14175 6903 31164 19647 25252 26844 10698 12431 17734 9949 31938 15248 6388 31335 14082 14576 25517 9098 3389 16068 30517 12355 19193 5004 4826 23089 10789 15701 15292 18745 8788 29467 25648 7185 16346 18132 1261 27044 30564 18995 4225 29734 1475 8940 7740 6779 22250 15944 17560 30951 25104 11786 20231 27027 17657 24505 9979 21348 27232 29443 14719 22131 25585 27571 15328 30928 6008 10323 2039 28963 14841 17285 30040 3061 26226 5013 9840 15708 20957 27401 13891 13294 6419 1354 7553 24076 25860 17532 12656 20324 14207 27375 9687)

rm -f report.csv
rm -f seeds.txt

seed_index=0

for query in "${QUERIES[@]}"
do
        for summary_size in "${SUMMARY_SIZES[@]}"
        do
                for time_window_size in "${TIME_WINDOW_SIZES[@]}"
                do
                        for stream_size in "${STREAM_SIZES[@]}"
                        do
                                for time_to_live in "${TIMES_TO_LIVE[@]}"
                                do
                                        for prob_distribution in "${PROB_DISTRIBUTIONS[@]}"
                                        do
                                                for eval_timestamp_count in "${EVAL_TIMESTAMPS_COUNTS[@]}"
                                                do
                                                        for eval_timestamp_dist in "${EVAL_TIMESTAMPS_PROB_DISTS[@]}"
                                                        do
                                                                for ((run=1; run<=NUM_OF_RUNS; run++))
                                                                do
                                                                        RANDOM_SEED=${SEEDS[$seed_index]}
									((seed_index += 1))
									if (( seed_index >= ${#SEEDS[@]} )); then
                                                                        	seed_index=0
									fi
                                                                        bash run_test.sh \
                                                                                ${summary_size} \
                                                                                ${time_window_size} \
                                                                                ${stream_size} \
                                                                                ${time_to_live} \
                                                                                ${prob_distribution} \
                                                                                ${eval_timestamp_count} \
                                                                                ${eval_timestamp_dist} \
                                                                                ${RANDOM_SEED} \
                                                                                "${query}" >/dev/null &
                                                                done
                                                        done
                                                done
                                        done
                                done
                        done
                done
                wait
        done
done
